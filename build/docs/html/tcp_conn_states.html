<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ripples: TCP Connection States</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Ripples<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">High Performant Software Architecture For Transaction Processing</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('tcp_conn_states.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">TCP Connection States</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>TCP connection logic diagram</h2>
<div class="image">
<object type="image/svg+xml" data="tcp_logic_diagram.svg" style="pointer-events: none;"></object>
<div class="caption">
TCP logic diagram</div></div>
<h2>TCP connection states</h2>
<h3>TCP_CONN_ST_ASSIGN_CONN_ID_ERR</h3>
<p>State indicates that unique TCP connection ID could not be assigned. Connection IDs are unique per Vectorloop and range from 0 to maximum value unsigned 64 bit integer can have. IDs are recycled. For this limit to be reached there has to be an unreasonable amount of TCP connections active per Vectorloop. It is more feasible there is a code error. The reason this state is even present is to cover a theoretical code error case. At this point connection is terminated and connection object is released.</p>
<ul>
<li>Set if connection ID could not be assigned, done when TCP connection is accepted.</li>
</ul>
<h3>TCP_CONN_ST_CLOSED_FOR_READ</h3>
<p>State indicates that connection was closed for read. At this point connection is terminated and connection object is released. <br  />
 If connection is closed while expecting data to be received, as indicated by state TCP_CONN_ST_WAIT_FOR_QUERY_DATA, it indicates that something unexpected happened. Either client closed the connection prematurely, or a network issue caused connection to be closed.</p>
<ul>
<li>Set when read from socket returns 0.</li>
</ul>
<h3>TCP_CONN_ST_READ_ERR</h3>
<p>State indicates that there was an unexpected error reading from connection. At this point connection is terminated and connection object is released.</p>
<ul>
<li>Set when read from socket returns error.</li>
</ul>
<h3>TCP_CONN_ST_QUERY_SIZE_TOOLARGE</h3>
<p>State indicates that query received exceeds maximum allowed length. At this point connection is terminated and connection object is released.</p>
<ul>
<li>Set when query len, as indicated by first 2 bytes, exceeds RIP_NS_PACKETSZ (512).</li>
</ul>
<h3>TCP_CONN_ST_WAIT_FOR_QUERY_DATA</h3>
<p>State indicates that connection is waiting for query data to arrive. This is either the first query over connection, or partial data for a query was received and waiting on remaining data to arrive. <br  />
 This state is subject to a timeout, by default 2 seconds. Significance of this timeout is to prevent bad behavior such as client opening a TCP connection and never sending query data over it, or client sending query data at a very slow rate. Both of these indicate bad client behavior and if not addressed via a timeout it could lead to resource exhaustion where all resources (TCP connections) are used up by bad behaving clients, hence denying service to other clients.</p>
<ul>
<li>Set when connection is established and first query over connection is anticipated.</li>
<li>Set when partial query was received on read of non first query.</li>
<li>Set after query is logged and partial query is in buffer.</li>
</ul>
<h3>TCP_CONN_ST_WAIT_FOR_QUERY</h3>
<p>State indicates that all queries were responded to and connection is idle waiting for more queries to arrive. <br  />
 This state is subject to a timeout, basically how long is TCP connection kept open in IDLE state, equivalent to TCP keepalive behavior.</p>
<ul>
<li>Set when read from socket returns (EAGAIN || EWOULDBOCK) and conn read buffer is empty (no partial query).</li>
<li>Set after query is logged and partial query is not in buffer.</li>
</ul>
<h3>TCP_CONN_ST_WAIT_FOR_WRITE</h3>
<p>State indicates that there are query responses to be sent and is waiting for all query responses to be written to socket. <br  />
 This state is subject to a timeout as waiting indefinitely for a socket to become writable could lead to resource exhaustion.</p>
<ul>
<li>Set when query responses are packed and ready for write.</li>
</ul>
<h3>TCP_CONN_ST_WRITE_ERR</h3>
<p>State indicates that there was an error writing to TCP socket. At this point connection is terminated and connection object is released.</p>
<ul>
<li>Set when write to socket returns error.</li>
</ul>
<h3>TCP_CONN_ST_CLOSED_FOR_WRITE</h3>
<p>State indicates that TCP socket was closed for write. At this point connection is terminated and connection object is released.</p>
<ul>
<li>Set when write to socket returns 0. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
